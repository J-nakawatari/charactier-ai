#!/bin/sh
# æ©Ÿæ¢°çš„ã«APIé‡è¤‡ã‚’é˜²ãpre-commitãƒ•ãƒƒã‚¯

echo "ğŸ” APIé‡è¤‡ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­..."

# 1. ESLintã§APIé‡è¤‡ã‚’ãƒã‚§ãƒƒã‚¯
cd backend
npx eslint src/**/*.ts --rule="custom-api-rules/no-duplicate-routes: error"

if [ $? -ne 0 ]; then
  echo "âŒ ESLint: APIé‡è¤‡ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
  exit 1
fi

# 2. TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯ï¼ˆå‹ãƒ¬ãƒ™ãƒ«é‡è¤‡æ¤œå‡ºï¼‰
npx tsc --noEmit

if [ $? -ne 0 ]; then
  echo "âŒ TypeScript: å‹ã‚¨ãƒ©ãƒ¼ï¼ˆé‡è¤‡ã®å¯èƒ½æ€§ï¼‰ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
  exit 1
fi

# 3. RouteRegistryãƒ†ã‚¹ãƒˆï¼ˆå®Ÿè¡Œæ™‚é‡è¤‡æ¤œå‡ºï¼‰
node -e "
  try {
    require('./src/index-new.ts');
    console.log('âœ… RouteRegistry: é‡è¤‡ãªã—');
  } catch (error) {
    if (error.message.includes('é‡è¤‡')) {
      console.error('âŒ RouteRegistry:', error.message);
      process.exit(1);
    }
  }
"

if [ $? -ne 0 ]; then
  exit 1
fi

echo "âœ… å…¨ã¦ã®APIé‡è¤‡ãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸ"