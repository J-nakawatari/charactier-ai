#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Gitleaksãƒã‚§ãƒƒã‚¯ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿ï¼‰
if command -v gitleaks >/dev/null 2>&1; then
  echo "ğŸ” æ©Ÿå¯†æƒ…å ±ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."
  gitleaks detect --source . -v
  if [ $? -ne 0 ]; then
    echo "âŒ æ©Ÿå¯†æƒ…å ±ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼"
    echo "è©³ç´°ã¯ä¸Šè¨˜ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
    exit 1
  fi
  echo "âœ… æ©Ÿå¯†æƒ…å ±ãƒã‚§ãƒƒã‚¯å®Œäº†"
else
  echo "ğŸ” æ©Ÿå¯†æƒ…å ±ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."
  echo "âŒ gitleaksãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“"
  echo "ğŸ“¦ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•:"
  echo ""
  echo "  macOS:    brew install gitleaks"
  echo "  Ubuntu:   sudo apt install gitleaks"
  echo "  Windows:  scoop install gitleaks"
  echo ""
  echo "ã¾ãŸã¯ https://github.com/gitleaks/gitleaks/releases ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"
  echo ""
  echo "âš ï¸  ä¸€æ™‚çš„ã«ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã«ã¯: git commit --no-verify"
  exit 1
fi
